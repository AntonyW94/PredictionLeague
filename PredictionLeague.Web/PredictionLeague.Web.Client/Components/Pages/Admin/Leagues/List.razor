@page "/admin/leagues"

@attribute [Authorize(Roles = "Administrator")]

@inject HttpClient Http
@inject NavigationManager NavigationManager

@using Microsoft.AspNetCore.Authorization
@using PredictionLeague.Shared.Admin.Leagues

<PageTitle>Manage Leagues</PageTitle>

<div class="page-container">
    <div class="admin-table-container">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h3 class="fw-bold text-white mb-0">Manage Leagues</h3>
            <button class="btn d-flex align-items-center green-button" @onclick='() => NavigationManager.NavigateTo("/admin/leagues/create")'>
                <span class="bi bi-plus-circle-fill me-2"></span>Create League
            </button>
        </div>

        @if (_leagues == null)
        {
            <p class="text-center text-white"><em>Loading...</em></p>
        }
        else
        {
            <table class="table striped-table responsive-table">
                <thead>
                    <tr>
                        <th>League Name</th>
                        <th>Season</th>
                        <th>Members</th>
                        <th>Entry Code</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var league in _leagues)
                    {
                        <tr>
                            <td data-label="League Name">@league.Name</td>
                            <td data-label="Season">@league.SeasonName</td>
                            <td data-label="Members">@league.MemberCount</td>
                            <td data-label="Entry Code">@league.EntryCode</td>
                            <td data-label="Actions" class="text-end">
                                <button class="btn btn-sm green-button" @onclick="() => EditLeague(league.Id)">Edit</button>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        }
    </div>
</div>

@code {
    private List<LeagueDto>? _leagues;
    protected override async Task OnInitializedAsync() { _leagues = await Http.GetFromJsonAsync<List<LeagueDto>>("api/admin/leagues"); }
    private void EditLeague(int leagueId) => NavigationManager.NavigateTo($"/admin/leagues/edit/{leagueId}");
}