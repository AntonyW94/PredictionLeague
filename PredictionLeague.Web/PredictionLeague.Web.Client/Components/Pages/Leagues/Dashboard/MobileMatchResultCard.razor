@using PredictionLeague.Contracts.Leagues
@using PredictionLeague.Contracts.Admin.Rounds

<div class="mobile-match-card">
    <div class="mobile-match-header">
        <div class="d-flex align-items-center">
            <img src="@Match.HomeTeamLogoUrl" class="match-logo-small" alt="@Match.HomeTeamName Logo" />
            <span class="mx-2 fs-5 fw-bold">@Match.HomeTeamAbbreviation vs @Match.AwayTeamAbbreviation</span>
            <img src="@Match.AwayTeamLogoUrl" class="match-logo-small" alt="@Match.AwayTeamName Logo" />
        </div>

        <MatchStatusBadge Status="Match.Status"
                          MatchDateTime="Match.MatchDateTime"
                          HomeScore="Match.ActualHomeTeamScore"
                          AwayScore="Match.ActualAwayTeamScore" />
    </div>

    <div class="table-responsive flex-grow-1">
        <table class="mobile-match-table">
            <tbody>
                @foreach (var player in Results)
                {
                    var prediction = player.Predictions.FirstOrDefault(p => p.MatchId == Match.Id);
                    <tr>
                        <td class="w-35 text-start fw-bold">@player.PlayerName</td>
                        <td class="w-30 text-center fw-bold">
                            @if (prediction?.HomeScore != null)
                            {
                                if (prediction.IsHidden)
                                {
                                    <span class="blurred-score" title="Predictions are hidden until the deadline.">0 - 0</span>
                                }
                                else
                                {
                                    <PredictionStatusBadge Status="Match.Status" HomeScore="prediction.HomeScore" AwayScore="prediction.AwayScore" PointsAwarded="prediction.PointsAwarded"></PredictionStatusBadge>
                                }
                            }
                            else
                            { 
                                @if (!player.HasPredicted && Deadline < DateTime.Now)
                                {
                                    <span class="not-predicted-icon text-pl-red bi bi-x-circle-fill" title="No predictions submitted"></span>
                                }
                                else
                                {
                                    <span class="bi bi-clock-fill not-predicted-icon" title="No prediction submitted."></span>
                                }
                            }
                        </td>
                        <td class="w-35 text-end fw-bold">@(prediction?.PointsAwarded ?? 0)</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

@code {
    [Parameter, EditorRequired] public MatchInRoundDto Match { get; set; } = null!;
    [Parameter, EditorRequired] public List<PredictionResultDto> Results { get; set; } = null!; 
    [Parameter, EditorRequired] public DateTime Deadline { get; set; }
}