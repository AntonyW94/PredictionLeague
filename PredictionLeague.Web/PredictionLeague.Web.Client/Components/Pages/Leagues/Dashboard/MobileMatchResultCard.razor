@using PredictionLeague.Contracts.Leagues
@using PredictionLeague.Contracts.Admin.Rounds

<div class="mobile-match-card">
    <div class="mobile-match-header">
        <div class="d-flex align-items-center">
            <img src="@Match.HomeTeamLogoUrl" class="match-logo-small" alt="@Match.HomeTeamName Logo"/>
            <span class="mx-2 fs-5 fw-bold">@Match.HomeTeamAbbreviation vs @Match.AwayTeamAbbreviation</span>
            <img src="@Match.AwayTeamLogoUrl" class="match-logo-small" alt="@Match.AwayTeamName Logo" />
        </div>
       
        <MatchStatusBadge 
            Status="Match.Status" 
            HomeScore="Match.ActualHomeTeamScore" 
            AwayScore="Match.ActualAwayTeamScore" />
    </div>

    <div class="table-responsive flex-grow-1">
        <table class="mobile-match-table">
            <tbody>
                @foreach (var player in Results)
                {
                    var prediction = player.Predictions.FirstOrDefault(p => p.MatchId == Match.Id);
                    <tr>
                        <td class="player-name-col fw-bold">@player.PlayerName</td>
                        <td class="text-center fw-bold">
                            @if (prediction?.HomeScore != null)
                            {
                                if (prediction.IsHidden)
                                {
                                    <span class="blurred-score" title="Predictions are hidden until the deadline.">0 - 0</span>
                                }
                                else
                                {
                                    <span>@prediction.HomeScore - @prediction.AwayScore</span>
                                }
                            }
                            else
                            {
                                <span class="bi bi-clock-fill not-predicted-icon" title="Match not started yet."></span>
                            }
                        </td>
                        <td class="mobile-prediction-points">@(prediction?.PointsAwarded ?? 0)</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

@code {
    [Parameter, EditorRequired]
    public MatchInRoundDto Match { get; set; } = null!;

    [Parameter, EditorRequired]
    public List<PredictionResultDto> Results { get; set; } = null!;
}